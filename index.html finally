<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#6366f1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>TailorPro App</title>

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root {
  --primary: #6366f1;
  --primary-light: #e0e7ff;
  --text-main: #1e293b;
  --text-light: #64748b;
  --bg-body: #f8fafc;
  --surface: #ffffff;
  --border: #e2e8f0;
  --success: #10b981;
  --danger: #ef4444;
  --shadow: 0 4px 20px -2px rgba(0, 0, 0, 0.05);
  --radius: 16px;
  --bottom-nav-height: 70px;
}

[data-theme="dark"] {
  --bg-body: #0f172a;
  --surface: #1e293b;
  --text-main: #f8fafc;
  --text-light: #94a3b8;
  --border: #334155;
}

* { box-sizing: border-box; font-family: 'Plus Jakarta Sans', 'Hind Siliguri', sans-serif; -webkit-tap-highlight-color: transparent; outline: none; }

body { 
  margin: 0; padding: 0; 
  background: var(--bg-body); 
  color: var(--text-main);
  height: 100vh;
  display: flex;
  flex-direction: column;
  overflow: hidden; /* App feel: no body scroll */
}

/* --- App Layout --- */
.app-header {
  background: var(--surface);
  padding: 15px 20px;
  display: flex; justify-content: space-between; align-items: center;
  box-shadow: 0 1px 0 var(--border);
  z-index: 100;
  height: 60px;
}

.brand { font-size: 20px; font-weight: 800; color: var(--primary); letter-spacing: -0.5px; }

.app-content {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  padding-bottom: 90px; /* Space for bottom nav */
  scroll-behavior: smooth;
}

/* Bottom Navigation */
.bottom-nav {
  position: fixed; bottom: 0; left: 0; right: 0;
  height: var(--bottom-nav-height);
  background: var(--surface);
  display: flex; justify-content: space-around; align-items: center;
  border-top: 1px solid var(--border);
  box-shadow: 0 -4px 20px rgba(0,0,0,0.03);
  z-index: 100;
}

.nav-item {
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  color: var(--text-light); border: none; background: none;
  font-size: 10px; font-weight: 600; gap: 4px; padding: 10px;
  transition: 0.2s; width: 100%;
}

.nav-item.active { color: var(--primary); }
.nav-item svg { width: 24px; height: 24px; fill: currentColor; }

/* --- Components --- */
.section { display: none; animation: fadeIn 0.3s ease; }
.section.active { display: block; }

@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

.card {
  background: var(--surface);
  padding: 20px; border-radius: var(--radius);
  box-shadow: var(--shadow);
  margin-bottom: 15px;
  border: 1px solid var(--border);
}

/* Modern Inputs */
.input-group { margin-bottom: 15px; }
.input-label { display: block; font-size: 12px; font-weight: 600; color: var(--text-light); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px; }
.input-field {
  width: 100%; padding: 14px;
  background: var(--bg-body); border: 1px solid var(--border);
  border-radius: 12px; color: var(--text-main); font-size: 16px; font-weight: 500;
  transition: 0.2s;
}
.input-field:focus { border-color: var(--primary); background: var(--surface); box-shadow: 0 0 0 3px var(--primary-light); }

.grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }

/* Buttons */
.btn {
  width: 100%; padding: 16px; border: none; border-radius: 14px;
  font-size: 16px; font-weight: 700; cursor: pointer;
  display: flex; justify-content: center; align-items: center; gap: 8px;
  transition: 0.2s;
}
.btn-primary { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); }
.btn-primary:active { transform: scale(0.98); }
.btn-outline { background: transparent; border: 1px dashed var(--primary); color: var(--primary); }
.btn-danger-soft { background: #fee2e2; color: #ef4444; }

/* List Item */
.customer-card {
  background: var(--surface); padding: 16px; border-radius: 16px;
  margin-bottom: 12px; border: 1px solid var(--border);
  display: flex; justify-content: space-between; align-items: center;
  position: relative; overflow: hidden;
}
.customer-card::before {
  content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px;
  background: var(--border);
}
.customer-card.paid::before { background: var(--success); }
.customer-card.due::before { background: var(--danger); }

.badge { font-size: 10px; padding: 3px 8px; border-radius: 6px; font-weight: 700; text-transform: uppercase; }
.badge-due { background: #fecaca; color: #ef4444; }
.badge-paid { background: #d1fae5; color: #10b981; }

/* Modal */
.modal-overlay {
  display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6);
  z-index: 200; backdrop-filter: blur(4px);
  justify-content: center; align-items: flex-end; /* Sheet style */
}
.modal-sheet {
  background: var(--surface); width: 100%; max-width: 600px;
  border-radius: 24px 24px 0 0; padding: 25px;
  max-height: 90vh; overflow-y: auto;
  animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
}
@keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

.action-bar { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 20px; }
.action-btn { display: flex; flex-direction: column; align-items: center; gap: 5px; font-size: 10px; background: var(--bg-body); border: none; padding: 10px; border-radius: 10px; cursor: pointer; color: var(--text-main); }

/* Utilities */
.fab {
  position: fixed; bottom: 90px; right: 20px;
  width: 56px; height: 56px; border-radius: 50%;
  background: var(--primary); color: white;
  display: flex; justify-content: center; align-items: center;
  box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
  font-size: 24px; border: none; cursor: pointer; z-index: 90;
}
.hidden { display: none; }
</style>
</head>

<body data-theme="light">

  <header class="app-header">
    <div class="brand">TailorPro</div>
    <div>
      <button onclick="toggleLanguage()" style="background:var(--bg-body); border:none; padding:8px 12px; border-radius:8px; font-weight:600; font-size:12px; color:var(--text-main);">EN/BN</button>
    </div>
  </header>

  <main class="app-content">
    
    <section id="sec-home" class="section active">
      <div class="input-group">
        <input type="text" id="search" class="input-field" placeholder="üîç Search Customer..." oninput="renderList()">
      </div>
      
      <div id="list-container">
        </div>
      
      <button class="fab" onclick="switchTab('add')">+</button>
    </section>

    <section id="sec-add" class="section">
      <div class="card">
        <h3 id="form-title" style="margin-top:0; color:var(--primary);">New Order</h3>
        <input type="hidden" id="edit-id">
        
        <div class="grid-2">
          <div class="input-group">
            <label class="input-label" id="lbl-name">Name</label>
            <input type="text" id="name" class="input-field">
          </div>
          <div class="input-group">
            <label class="input-label" id="lbl-phone">Phone</label>
            <input type="tel" id="phone" class="input-field">
          </div>
        </div>

        <div class="grid-2">
          <div class="input-group">
            <label class="input-label" id="lbl-type">Type</label>
            <select id="dressType" class="input-field" onchange="generateForm()">
              <option value="shirt">Shirt</option>
              <option value="pant">Pant</option>
              <option value="kurta">Kurta</option>
              <option value="salwar">Salwar</option>
              <option value="blouse">Blouse</option>
            </select>
          </div>
          <div class="input-group">
            <label class="input-label" id="lbl-delivery">Delivery</label>
            <input type="date" id="deliveryDate" class="input-field">
          </div>
        </div>

        <div style="background:var(--bg-body); padding:15px; border-radius:12px; margin-bottom:15px;">
          <label class="input-label" id="lbl-measure">Measurements</label>
          <div id="dynamic-grid" class="grid-2" style="margin-bottom:10px;"></div>
          <div id="extra-container"></div>
          <button class="btn btn-outline" style="padding:10px; font-size:13px;" onclick="addExtraField()">+ Add Size</button>
        </div>

        <div class="grid-2">
          <div class="input-group">
            <label class="input-label" id="lbl-total">Total</label>
            <input type="number" id="totalBill" class="input-field" placeholder="0">
          </div>
          <div class="input-group">
            <label class="input-label" id="lbl-advance">Advance</label>
            <input type="number" id="advance" class="input-field" placeholder="0">
          </div>
        </div>

        <div class="input-group">
          <label class="input-label" id="lbl-notes">Notes</label>
          <textarea id="notes" class="input-field" rows="2"></textarea>
        </div>

        <div class="grid-2">
          <button class="btn btn-primary" onclick="saveCustomer()" id="btn-save">Save</button>
          <button class="btn btn-danger-soft" onclick="resetForm(); switchTab('home')">Cancel</button>
        </div>
      </div>
    </section>

    <section id="sec-settings" class="section">
      <div class="card">
        <h3>Settings</h3>
        <button class="btn btn-outline" onclick="toggleTheme()" style="margin-bottom:10px;">üåì Toggle Dark Mode</button>
        <button class="btn btn-outline" onclick="toggleLanguage()">üåê Change Language</button>
        <p style="text-align:center; font-size:12px; color:var(--text-light); margin-top:20px;">TailorPro v3.0</p>
      </div>
    </section>

  </main>

  <nav class="bottom-nav">
    <button class="nav-item active" onclick="switchTab('home')" id="nav-home">
      <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
      <span>Home</span>
    </button>
    <button class="nav-item" onclick="switchTab('add')" id="nav-add">
      <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
      <span>New</span>
    </button>
    <button class="nav-item" onclick="switchTab('settings')" id="nav-settings">
      <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.04.24.24.41.48.41h3.84c.24 0 .43-.17.47-.41l.36-2.54c.59-.24 1.13-.57 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.08-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
      <span>Settings</span>
    </button>
  </nav>

  <div class="modal-overlay" id="modal">
    <div class="modal-sheet" id="modalContent"></div>
  </div>

<script>
let currentLang = localStorage.getItem("lang") || "en";
let customers = JSON.parse(localStorage.getItem("tailor_pro_attractive")) || [];

const i18n = {
  en: {
    lbl_name: "Customer Name", lbl_phone: "Phone Number", lbl_type: "Dress Type",
    lbl_measure: "Measurements", lbl_total: "Total Bill", lbl_advance: "Advance",
    lbl_delivery: "Delivery Date", lbl_notes: "Notes", btn_save: "Save Order",
    search_ph: "üîç Search Customer...",
    shirt: ["Length", "Chest", "Shoulder", "Sleeve", "Neck"],
    pant: ["Length", "Waist", "Hip", "Thigh", "Bottom"],
    kurta: ["Length", "Chest", "Shoulder", "Sleeve"],
    salwar: ["Length", "Body", "Waist", "Hip", "Sleeve", "Bottom"],
    blouse: ["Length", "Chest", "Waist", "Shoulder", "Sleeve"]
  },
  bn: {
    lbl_name: "‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ", lbl_phone: "‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞", lbl_type: "‡¶™‡ßã‡¶∂‡¶æ‡¶ï",
    lbl_measure: "‡¶Æ‡¶æ‡¶™ (‡¶á‡¶û‡ßç‡¶ö‡¶ø)", lbl_total: "‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶≤", lbl_advance: "‡¶ú‡¶Æ‡¶æ",
    lbl_delivery: "‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø", lbl_notes: "‡¶®‡ßã‡¶ü", btn_save: "‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®",
    search_ph: "üîç ‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶´‡ßã‡¶® ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®...",
    shirt: ["‡¶≤‡¶Æ‡ßç‡¶¨‡¶æ", "‡¶¨‡ßÅ‡¶ï", "‡¶ï‡¶æ‡¶Å‡¶ß", "‡¶π‡¶æ‡¶§‡¶æ", "‡¶ó‡¶≤‡¶æ"],
    pant: ["‡¶≤‡¶Æ‡ßç‡¶¨‡¶æ", "‡¶ï‡ßã‡¶Æ‡¶∞", "‡¶π‡¶ø‡¶™", "‡¶•‡¶æ‡¶á", "‡¶¨‡¶ü‡¶Æ"],
    kurta: ["‡¶≤‡¶Æ‡ßç‡¶¨‡¶æ", "‡¶¨‡ßÅ‡¶ï", "‡¶ï‡¶æ‡¶Å‡¶ß", "‡¶π‡¶æ‡¶§‡¶æ"],
    salwar: ["‡¶≤‡¶Æ‡ßç‡¶¨‡¶æ", "‡¶¨‡¶°‡¶ø", "‡¶ï‡ßã‡¶Æ‡¶∞", "‡¶π‡¶ø‡¶™", "‡¶π‡¶æ‡¶§‡¶æ", "‡¶™‡¶æ‡ßü‡¶ö‡¶æ"],
    blouse: ["‡¶≤‡¶Æ‡ßç‡¶¨‡¶æ", "‡¶¨‡ßÅ‡¶ï", "‡¶ï‡ßã‡¶Æ‡¶∞", "‡¶ï‡¶æ‡¶Å‡¶ß", "‡¶π‡¶æ‡¶§‡¶æ"]
  }
};

// --- App Navigation ---
function switchTab(tabId) {
  document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
  
  document.getElementById('sec-' + tabId).classList.add('active');
  document.getElementById('nav-' + tabId).classList.add('active');

  if(tabId === 'add' && !document.getElementById("edit-id").value) {
    resetForm();
    generateForm();
  }
}

function generateForm() {
  const type = document.getElementById("dressType").value;
  const fields = i18n[currentLang][type];
  const grid = document.getElementById("dynamic-grid");
  
  if (!document.getElementById("edit-id").value) {
    grid.innerHTML = "";
    fields.forEach(f => {
      grid.innerHTML += `<div class="input-group" style="margin-bottom:0"><label class="input-label">${f}</label><input type="text" class="input-field base-measure" data-label="${f}"></div>`;
    });
  }
}

// --- Logic ---
function addExtraField(label = "", val = "") {
  const div = document.createElement("div");
  div.className = "grid-2 extra-row";
  div.style.marginBottom = "10px";
  div.innerHTML = `
    <input type="text" class="input-field extra-lbl" placeholder="Label" value="${label}">
    <div style="display:flex; gap:5px;">
      <input type="text" class="input-field extra-val" placeholder="Value" value="${val}">
      <button onclick="this.parentElement.parentElement.remove()" style="background:#fee2e2; border:none; border-radius:8px; color:red; width:40px;">‚úï</button>
    </div>
  `;
  document.getElementById("extra-container").appendChild(div);
}

function saveCustomer() {
  const editId = document.getElementById("edit-id").value;
  const name = document.getElementById("name").value;
  const phone = document.getElementById("phone").value;
  
  if(!name || !phone) return alert("Name & Phone required!");

  let measures = {};
  document.querySelectorAll(".base-measure").forEach(el => measures[el.dataset.label] = el.value);
  document.querySelectorAll(".extra-row").forEach(el => {
    const l = el.querySelector(".extra-lbl").value;
    const v = el.querySelector(".extra-val").value;
    if(l) measures[l] = v;
  });

  const data = {
    id: editId ? parseInt(editId) : Date.now(),
    name, phone, type: document.getElementById("dressType").value,
    total: document.getElementById("totalBill").value || 0,
    advance: document.getElementById("advance").value || 0,
    delivery: document.getElementById("deliveryDate").value,
    notes: document.getElementById("notes").value,
    measures,
    date: new Date().toLocaleDateString()
  };

  if(editId) {
    customers[customers.findIndex(c => c.id == editId)] = data;
  } else {
    customers.push(data);
  }

  localStorage.setItem("tailor_pro_attractive", JSON.stringify(customers));
  resetForm();
  switchTab('home');
  renderList();
}

function renderList() {
  const q = document.getElementById("search").value.toLowerCase();
  const list = document.getElementById("list-container");
  list.innerHTML = "";
  
  customers.filter(c => c.name.toLowerCase().includes(q) || c.phone.includes(q))
  .slice().reverse().forEach(c => {
    const due = c.total - c.advance;
    list.innerHTML += `
      <div class="customer-card ${due>0?'due':'paid'}" onclick="showSheet(${c.id})">
        <div>
          <div style="font-weight:700; font-size:16px;">${c.name}</div>
          <div style="color:var(--text-light); font-size:12px; margin-top:4px;">${c.phone} ‚Ä¢ ${c.type.toUpperCase()}</div>
        </div>
        <div style="text-align:right;">
          <span class="badge ${due>0?'badge-due':'badge-paid'}">${due>0 ? 'Due: '+due : 'PAID'}</span>
          <div style="font-size:11px; color:var(--text-light); margin-top:5px;">${c.delivery || ''}</div>
        </div>
      </div>
    `;
  });
}

function showSheet(id) {
  const c = customers.find(x => x.id === id);
  const due = c.total - c.advance;
  
  let mHtml = "";
  for(let k in c.measures) mHtml += `<div><span style="color:var(--text-light); font-size:11px;">${k}</span><br><b>${c.measures[k]}</b></div>`;

  document.getElementById("modalContent").innerHTML = `
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
      <h2 style="margin:0;">${c.name}</h2>
      <button onclick="closeModal()" style="background:none; border:none; font-size:24px;">&times;</button>
    </div>
    <div style="background:var(--bg-body); padding:15px; border-radius:12px; margin-bottom:15px;">
       <div class="grid-2" style="font-size:14px;">${mHtml}</div>
    </div>
    <div style="display:flex; justify-content:space-between; margin-bottom:20px; font-weight:600;">
      <span>Total: ${c.total}</span>
      <span style="color:${due>0?'red':'green'}">Due: ${due}</span>
    </div>
    <div class="action-bar">
      <button class="action-btn" onclick="editCust(${c.id})">‚úèÔ∏è Edit</button>
      <button class="action-btn" onclick="shareWA(${c.id})">üí¨ WhatsApp</button>
      <button class="action-btn" onclick="dlPDF(${c.id})">üìÑ PDF</button>
      <button class="action-btn" onclick="delCust(${c.id})" style="color:red;">üóë Delete</button>
    </div>
  `;
  document.getElementById("modal").style.display = "flex";
}

function editCust(id) {
  const c = customers.find(x => x.id === id);
  document.getElementById("edit-id").value = c.id;
  document.getElementById("name").value = c.name;
  document.getElementById("phone").value = c.phone;
  document.getElementById("dressType").value = c.type;
  document.getElementById("totalBill").value = c.total;
  document.getElementById("advance").value = c.advance;
  document.getElementById("deliveryDate").value = c.delivery;
  document.getElementById("notes").value = c.notes;
  
  closeModal();
  switchTab('add');
  
  const grid = document.getElementById("dynamic-grid");
  grid.innerHTML = "";
  document.getElementById("extra-container").innerHTML = "";

  // Standard fields
  i18n[currentLang][c.type].forEach(f => {
    grid.innerHTML += `<div class="input-group" style="margin-bottom:0"><label class="input-label">${f}</label><input type="text" class="input-field base-measure" data-label="${f}" value="${c.measures[f]||''}"></div>`;
  });

  // Extra fields
  for(let k in c.measures) {
    if(!i18n[currentLang][c.type].includes(k)) addExtraField(k, c.measures[k]);
  }
}

function shareWA(id) {
  const c = customers.find(x => x.id === id);
  window.open(`https://wa.me/88${c.phone}?text=Order%20Details:%0A${c.name}%0ADue:${c.total-c.advance}`);
}

function dlPDF(id) {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const c = customers.find(x => x.id === id);
  doc.text(`${c.name} - ${c.type}`, 20, 20);
  doc.text(`Total: ${c.total} | Due: ${c.total-c.advance}`, 20, 30);
  let y=40;
  for(let k in c.measures) { doc.text(`${k}: ${c.measures[k]}`, 20, y); y+=10; }
  doc.save("receipt.pdf");
}

function delCust(id) {
  if(confirm("Delete?")) {
    customers = customers.filter(c => c.id !== id);
    localStorage.setItem("tailor_pro_attractive", JSON.stringify(customers));
    closeModal();
    renderList();
  }
}

function updateLangUI() {
  const l = i18n[currentLang];
  document.getElementById("lbl_name").innerText = l.lbl_name;
  // ... Update other labels similarly ...
  document.getElementById("search").placeholder = l.search_ph;
  renderList();
}

function toggleLanguage() {
  currentLang = currentLang === "en" ? "bn" : "en";
  localStorage.setItem("lang", currentLang);
  location.reload(); // Simple reload to apply all lang changes
}

function toggleTheme() {
  document.body.dataset.theme = document.body.dataset.theme === "dark" ? "light" : "dark";
}

function resetForm() {
  document.getElementById("edit-id").value = "";
  document.querySelectorAll("input, textarea").forEach(e => e.value = "");
  document.getElementById("extra-container").innerHTML = "";
}

function closeModal() { document.getElementById("modal").style.display = "none"; }

// Init
document.addEventListener("DOMContentLoaded", () => {
  renderList();
  generateForm();
});
</script>
</body>
</html>
